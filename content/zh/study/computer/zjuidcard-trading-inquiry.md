+++
title = "使用 Excel 对校园卡流水对账"
date = "2019-06-30T09:11:32+08:00"
tags = ["idcard","zju"]
dropCap = true
displayCopyright = true
gitinfo = true
+++

近日看到很多同学都在对校园卡未消费却一直在扣费的问题感到困惑和愤怒。以下评论搬运自 CC98。

同学甲：

> 前两天，连续两次扣我 30 元，只剩下 5 元的时候，打算充钱，结果一刷卡，发现 5 元都被扣了。昨天余额 82 元多，查流水的时候消费信息全部消失。今天晚上回来的晚，刷卡就剩下零点几毛了。我只想说一句，有人能不能告诉我我的钱到底欠多少，可以把钱像电费一样的在宿舍贴出来不行吗？什么样的脑袋想出来这种破办法，P 事办不好。在未经允许的情况下，没有公告的情况下，你们是在正大光明的盗窃啊。我怎么分辨是有系统在扣费还是有人在冒刷我的卡？

同学乙：

> 请停止这种愚蠢的行为，而且请你们出面给一个说法，否则我会在 98 上号召集体投诉。那个时候希望有人站出来承担责任。

同学丙：

> 我昨天晚上吃完饭卡里还有 19 元多，今天中午就直接没了，重新充了 100，变成了 98 元多（此时已经被冒办了，扣了 20 元手续费），当时还在奇怪明明还有钱以及正常情况下为什么会欠费，下午洗澡的时候我的卡完全刷不出，用支付宝一查只有 88 了！说明被别人补办盗刷了！

对于这件事，学校官方的回复是：

> 各师生用户：<br>
> 6 月 26 日，陆续有同学反映，校园卡消费流水清单的金额有异，质疑是否扣除有误。<br>
> 经查，因紫金港校区东区水控服务器曾发生故障，致最近三个月的洗澡流水未正常上传至校园卡系统。6 月 25 日我们重新上传了相应流水数据，并对以往消费产生的金额进行补扣。补扣只在余额充足情况下进行，预计陆续补扣工作至 7 月 2 日结束。请大家保证校园卡里余额充足，以保证日常消费。<br>
> 现已查明，补扣不会多扣或错扣消费金额，请大家放心。大家可通过[校园卡服务平台](http://ecardhall.zju.edu.cn:808)、校园卡 APP 查询流水，我们正加紧对自助一体机查询异常问题进行检修。<br>
> 因未预计到补扣会对消费流水清单产生影响，未及时发布通知。给大家带来不便，敬请谅解。我们今后处理类似问题会更谨慎应对。

说白了，校园宝和校园卡中心的后台数据库似乎是不一样的。3 月份至 5 月份的水费有的只是「生成」了还没有「入账」，这一次是统一入账。虽然说扣的费用好像并没有错，但这件事依然给同学们带来了不少麻烦。毕竟大部分人都是 “月光”，本来卡里的钱正好能支撑到月末，这一次扣费，钱可能就不够花了。

我看了我的校园卡流水记录，似乎并没有这样的事情发生。毕竟这两年都住在云峰学园，寝室里有独卫，不存在刷卡用水这一操作。这件事本来与我无关了，但毕竟这个暑假要换校区了，谁能预测以后会不会发生呢？今天看到有人在 CC98 上分享了一个使用 Excel 查看校园卡流水记录的教程，便跟着帖子实际操作了一下，发现确实是一个不错的办法。没有涉及到写程序爬数据，小白都能自己完成。

## 获取数据

登录[校园卡服务平台](http://ecardhall.zju.edu.cn:808/)，进入个人主页，点击左侧栏的「流水信息」，进入流水信息查询页面。

![zjuidcard-trading-inquiry-0.jpg](/images/zjuidcard-trading-inquiry-0.jpg "流水信息查询界面")

将查询日期开始时间选在你入学前，结束时间选今天即可。点击查询，即可查询到你从入学到现在的所有消费和充值记录。那么现在出现了一个问题，默认分页是每页 15 条的，最大也只能 100 条每页，怎么快速获取所有数据呢？

首先，对分页这里单击右键，点击检查。

![zjuidcard-trading-inquiry-1.jpg](/images/zjuidcard-trading-inquiry-1.jpg "审查元素")

然后点开图中所示的 `select`，双击这里的 `100` 修改其中为 `10000`。

![zjuidcard-trading-inquiry-2.jpg](/images/zjuidcard-trading-inquiry-2.jpg "更改元素")

更改完毕后，不要刷新网页，再次选择分页，可以看到最后一项变为 `10000`，选择即可，现在你的校园卡流水记录就完整显示在同一页面上，不用翻页查询了。我觉得一个人在学校使用校园卡消费的次数不可能达到 10000 次吧。

![zjuidcard-trading-inquiry-3.jpg](/images/zjuidcard-trading-inquiry-3.jpg "选择显示数目")

## 复制到 Excel

从第一行的时间开始选中 一直拖到最后一行的卡余额后，用 Ctrl+C 进行复制。选中一部分后，鼠标就可以松开了，然后直接拖到滚动条到末尾，这时候按住 Shift 再去点击最后一行，即可全选数据。然后新建一个 Excel 文件，把数据粘贴进去就行了。

<p class="note-warning">
注：在复制网页表格中的数据的时候，不能将表格左边的编号复制。亲测，如果复制了编号，在 Excel 当中就只显示了编号，实际数据并没有复制进来。
</p>

## 数据筛选

在 Excel 中，直接选中交易金额那一列，Excel 右下角会给你显示「求和：」的结果，这个值就应该与当前余额相等。

在实际操作时，发现有一类交易不会修改余额，所以需要用筛选去掉「交易取消/冲正」。在第一行建立筛选，

![zjuidcard-trading-inquiry-4.jpg](/images/zjuidcard-trading-inquiry-4.jpg "筛选数据")